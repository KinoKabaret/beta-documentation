\section{Installations}

Overview text required.





\subsection{Installing a webserver}

\textbf{Installing required packages}\\

Make sure the AXIOM Beta is connected to the internet and then on the commandline:\\

Update mirrors database: 

\consolecommand{pacman -Syy}

Install webserver: 

\consolecommand{pacman -S lighttpd php php-cgi}

Start the webservice: 

\consolecommand{systemctl start lighttpd}

Write any pending changes to the file system:

\consolecommand{sync}





\subsection{Configuring a webserver}

This follows the guide from the lighttpd archlinux wiki page: \href{https://wiki.archlinux.org/index.php/lighttpd}{https://wiki.archlinux.org/index.php/lighttpd}

\consolecommand{    mkdir /etc/lighttpd/conf.d/
    nano /etc/lighttpd/conf.d/cgi.conf}
    
... and place the following content in the file: 

\begin{lstlisting}[language=bash,morekeywords=$,keywordstyle=\bfseries,frame=none,xleftmargin=.25in,belowskip=2em, aboveskip=2em]
    server.modules += ( "mod\_cgi" )
     
     cgi.assign                 = ( ".pl"  => "/usr/bin/perl",
                                   ".cgi" => "/usr/bin/perl",
                                   ".rb"  => "/usr/bin/ruby",
                                   ".erb" => "/usr/bin/eruby",
                                   ".py"  => "/usr/bin/python",
                                   ".php" => "/usr/bin/php-cgi" )
     
     index-file.names           += ( "index.pl",   "default.pl",
                                   "index.rb",   "default.rb",
                                   "index.erb",  "default.erb",
                                   "index.py",   "default.py",
                                   "index.php",  "default.php" )
\end{lstlisting}    

For PHP scripts you will need to make sure the following is set in /etc/php/php.ini 

\consolecommand{cgi.fix\_pathinfo = 1}

In your Lighttpd configuration file, /etc/lighttpd/lighttpd.conf add: 

\consolecommand{include "conf.d/cgi.conf"}

Create a new configuration file /etc/lighttpd/conf.d/fastcgi.conf 

\begin{lstlisting}[language=bash,morekeywords=$,keywordstyle=\bfseries,frame=none,xleftmargin=.25in,belowskip=2em, aboveskip=2em]
    # Make sure to install php and php-cgi. See:                                                             
    # https://wiki.archlinux.org/index.php/Fastcgi\_and\_lighttpd#PHP
     
    server.modules += ("mod_fastcgi")
     
    # FCGI server
    # ===========
    #
    # Configure a FastCGI server which handles PHP requests.
    #
    index-file.names += ("index.php")
    fastcgi.server = ( 
        # Load-balance requests for this path...
        ".php" => (
            # ... among the following FastCGI servers. The string naming each
            # server is just a label used in the logs to identify the server.
            "localhost" => ( 
                "bin-path" => "/usr/bin/php-cgi",
                "socket" => "/tmp/php-fastcgi.sock",
                # breaks SCRIPT\_FILENAME in a way that PHP can extract PATH\_INFO
                # from it 
                "broken-scriptfilename" => "enable",
                # Launch (max-procs + (max-procs * PHP_FCGI\_CHILDREN)) procs, where
                # max-procs are "watchers" and the rest are "workers". See:
                # https://redmine.lighttpd.net/projects/1/wiki/frequentlyaskedquestions#How-many-php-CGI-processes-will-lighttpd-spawn 
                "max-procs" => 4, # default value
                "bin-environment" => (
                    "PHP\_FCGI\_CHILDREN" => "1" # default value
                )
            )
        )   
    )
\end{lstlisting} 

Make lighttpd use the new configuration file /etc/lighttpd/lighttpd.conf 

\consolecommand{include "conf.d/fastcgi.conf"}

Restart lighttpd: 

\consolecommand{systemctl restart lighttpd}

To test php create a file: /src/http/index.php with content:

\consolecommand{    <?php
    phpinfo();
    ?>} 
    
... and open this IP address of your AXIOM Beta in a browser. If you see the php info status page everything worked successfully.     






\subsection{Installing AXIOM Beta Web GUI software}

Download this repository - \href{https://github.com/apertus-open-source-cinema/beta-software}{https://github.com/apertus-open-source-cinema/beta-software}\\

1. Copy all files from the http directory of the repository to your AXIOM Beta /srv/http/ directory.\\
2. Copy all files from the beta-scripts directory of the repository to your AXIOM Beta /root/ directory.\\ 

\textbf{Edit /etc/sudoers files:}\\

Under the line: 

\consolecommand{root ALL=(ALL) ALL}

Add:

\consolecommand{http ALL=(ALL) NOPASSWD: ALL}

This allows the http user to do anything with the system so it can be considered a security vulnerability - but for development this should not be an issue, later on we will define the http priviledges more securely.\\

For testing sudoers: 

\consolecommand{sudo -u http sudo whoami}

If it returns \importantKeyword{root} then you are all set.\\

This should provide you with a working webbased GUI.\\

\textbf{Note :} \importantKeyword{lighttpd} does not start automatically when the AXIOM Beta boots, this still needs to be configured: 

\consolecommand{systemctl enable lighttpd}

\textbf{Note also:} Opening any websites that read image sensor registers before initializing the image sensor \importantKeyword{kick\_manual.sh} will freeze/crash the camera. 